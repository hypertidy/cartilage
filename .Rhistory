usethis::use_blank_slate()
usethis::use_blank_slate("project")
usethis::use_data_raw()
install.packages("here")
here::here()
here::here("data-raw")
f <- here::here("data-raw", basename(u))
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_bay_P080_2018.nc"
f <- here::here("data-raw", basename(u))
f
if (!file.exists(f)) curl::curl_download(u, f)
monterey_dem <- raster::raster(f)
library(raster)
monterey_dem
mean(c(-122.0301, -121.78))
mean(c(36.59986, 36.98014))
target <- projectExtent(monterey_dem, "+proj=lcc +lon_0=-122 +lat_0=36.8 +lat_1=36.5 +lat_2=37 +datum=WGS84")
target
?projectExtent
res(target) <- 80
monterey_dem0 <- raster::raster(f)
spex::buffer_extent(target)
spex::buffer_extent(target, 80)
target <- projectExtent(monterey_dem0, "+proj=lcc +lon_0=-122 +lat_0=36.8 +lat_1=36.5 +lat_2=37 +datum=WGS84")
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
target
monterey_dem <- projectRaster(monterey_dem0, target)
plot(monterey_dem)
plot(monterey_dem0)
u <- "https://www.ngdc.noaa.gov/thredds/catalog/regional/catalog.html?dataset=regionalDatasetScan/monterey_13_mhw_2012.nc"
f <- here::here("data-raw", basename(u))
if (!file.exists(f)) curl::curl_download(u, f)
f
monterey_dem0 <- raster::raster(f)
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_13_mhw_2012.nc"
f <- here::here("data-raw", basename(u))
if (!file.exists(f)) curl::curl_download(u, f)
monterey_dem0 <- raster::raster(f)
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_13_mhw_2012.nc"
f <- here::here("data-raw", basename(u))
if (!file.exists(f)) curl::curl_download(u, f)
u
f
if (!file.exists(f)) curl::curl_download(u, f)
monterey_dem0 <- raster::raster(f)
monterey_dem0
mean(c(-122.42, -121.28))
mean(c(35.69995, 37.20005))
target <- projectExtent(monterey_dem0, "+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
res(monterey_dem0)
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
monterey_dem
plot(monterey_dem)
contour(monterey_dem, levels = 0, add = T)
crop(monterey_dem0, extent(monterey_dem0, 1, 8001, 1001, 9001))
plot(lazyraster(filename(monterey_dem0)))
library(lazyraster)
plot(lazyraster(filename(monterey_dem0)))
plot(extent(monterey_dem0, 1, 8001, 1001, 9001), add = T)
## original rayshader used seq(1, 8001, by = 10) and seq(1001, 9001, by = 20)
target <- projectExtent(extent(monterey_dem0, 1, 8001, 1001, 9001),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
## original rayshader used seq(1, 8001, by = 10) and seq(1001, 9001, by = 20)
target <- projectExtent(crop(raster(monterey_dem0), extent(monterey_dem0, 1, 8001, 1001, 9001)),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
target
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
monterey_dem
plot(monterey_dem)
8 * 20
monterey_dem0 <- raster::raster(f)
## original rayshader used seq(1, 8001, by = 20) and seq(1001, 9001, by = 20)
target <- projectExtent(crop(raster(monterey_dem0), extent(monterey_dem0, 1, 8001, 1001, 9001)),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
?QUAD
library(anglr)
?QUAD
plot3d(copy_down(monterey_dem), monterey_dem)
plot3d(copy_down(QUAD(monterey_dem)), monterey_dem)
plot3d(copy_down(QUAD(monterey_dem), monterey_dem))
library(rayshader)
?ray_shade
sh <- ray_shade(as.matrix(monterey_dem))
plot_map(sh)
sh <- monterey_dem %>%
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(montereybay,zscale=200)) %>%
add_shadow(ambient_shade(montereybay,zscale=200))
sh <- monterey_dem %>%  as.matrix() %>%
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(montereybay,zscale=200)) %>%
add_shadow(ambient_shade(montereybay,zscale=200))
mdem <- monterey_dem %>%  as.matrix()
sh <- mdem  %>%
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(mdem,zscale=200)) %>%
add_shadow(ambient_shade(mdem,zscale=200))
mdem <- aggregate(monterey_dem, fact = 4) %>%  as.matrix()
sh <- mdem  %>%
sphere_shade(texture = "imhof3") %>%
add_water(detect_water(mdem, min_area = 400),color="imhof3")
plot_map(sh)
plot_3d(mdem, water=TRUE, zscale=50, theta=-45,
waterdepth = 0, wateralpha = 0.6, watercolor = "#88DDFF",
waterlinecolor = "white", waterlinealpha = 0.5)
mdem  %>%
sphere_shade(texture = "imhof3") %>%
add_water(detect_water(mdem, min_area = 400),color="imhof3") %>%
plot_3d(mdem, water=TRUE, zscale=50, theta=-45,
waterdepth = 0, wateralpha = 0.6, watercolor = "#88DDFF",
waterlinecolor = "white", waterlinealpha = 0.5)
mdem  %>%
sphere_shade(texture = "imhof1") %>%
add_water(detect_water(mdem, min_area = 400),color="imhof3") %>%
plot_3d(mdem, water=TRUE, zscale=50, theta=-45,
waterdepth = 0, wateralpha = 0.6, watercolor = "#88DDFF",
waterlinecolor = "white", waterlinealpha = 0.5)
#mdem <- aggregate(monterey_dem, fact = 4) %>%  as.matrix()
mdem <- as.matrix(monterey_dem)
mdem  %>%
sphere_shade(texture = "imhof1") %>%
add_water(detect_water(mdem, min_area = 400),color="imhof3") %>%
plot_3d(mdem, water=TRUE, zscale=50, theta=-45,
waterdepth = 0, wateralpha = 0.6, watercolor = "#88DDFF",
waterlinecolor = "white", waterlinealpha = 0.5)
mdem <- aggregate(monterey_dem, fact = 4) %>%  as.matrix()
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1")
str(sh)
brick(sh)
rgdal::writeGDAL(as(brick(sh), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
str(qm)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)), 1:ncell(monterey_dem))[qm$ib, ]
range(qm$ib)
ncell(monterey_dem)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ])))[qm$ib, ]
shade3d(qm, texture = "texture.png")
library(rgl)
shade3d(qm, texture = "texture.png")
str(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
range(qm$ib)
qm <- quadmesh::quadmesh(monterey_dem)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ])))[qm$ib, ]
library(rgl)
shade3d(qm, texture = "texture.png")
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ])))
library(rgl)
shade3d(qm, texture = "texture.png")
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
shade3d(qm, texture = "texture.png")
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_bay_P080_2018.nc"
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_13_mhw_2012.nc"
f <- here::here("data-raw", basename(u))
if (!file.exists(f)) curl::curl_download(u, f)
monterey_dem0 <- raster::raster(f)
## original rayshader used seq(1, 8001, by = 20) and seq(1001, 9001, by = 20)
target <- projectExtent(crop(raster(monterey_dem0), extent(monterey_dem0, 1, 8001, 1001, 9001)),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
library(anglr)
plot3d(copy_down(QUAD(monterey_dem), monterey_dem))
library(rayshader)
mdem <- aggregate(monterey_dem, fact = 4) %>%  as.matrix()
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1")
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
library(raster)
## original rayshader used seq(1, 8001, by = 20) and seq(1001, 9001, by = 20)
target <- projectExtent(crop(raster(monterey_dem0), extent(monterey_dem0, 1, 8001, 1001, 9001)),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
library(anglr)
plot3d(copy_down(QUAD(monterey_dem), monterey_dem))
library(rayshader)
mdem <- aggregate(monterey_dem, fact = 4) %>%  as.matrix()
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1")
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
shade3d(qm, texture = "texture.png")
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_bay_P080_2018.nc"
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_13_mhw_2012.nc"
f <- here::here("data-raw", basename(u))
if (!file.exists(f)) curl::curl_download(u, f)
monterey_dem0 <- raster::raster(f)
library(raster)
## original rayshader used seq(1, 8001, by = 20) and seq(1001, 9001, by = 20)
target <- projectExtent(crop(raster(monterey_dem0), extent(monterey_dem0, 1, 8001, 1001, 9001)),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
# library(anglr)
# plot3d(copy_down(QUAD(monterey_dem), monterey_dem))
library(rayshader)
mdem <- aggregate(monterey_dem, fact = 4) %>%  as.matrix()
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1")
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
shade3d(qm, texture = "texture.png")
shade3d(qm, texture = "texture.png", col = "white")
rgdal::writeGDAL(as(flip(brick(sh * 256), "y"), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
shade3d(qm, texture = "texture.png", col = "white")
rgdal::writeGDAL(as(t(flip(brick(sh * 256), "y")), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
shade3d(qm, texture = "texture.png", col = "white")
rgdal::writeGDAL(as(t(brick(sh * 256)), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
shade3d(qm, texture = "texture.png", col = "white")
rgdal::writeGDAL(as(t(flip(brick(sh * 256), "x")), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
shade3d(qm, texture = "texture.png", col = "white")
rgdal::writeGDAL(as(flip(brick(sh * 256), "x"), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
shade3d(qm, texture = "texture.png", col = "white")
## can't see what the orientation is yet, rayshader works in something different to either image or raster
a <- matrix(raster::extract(mdem,raster::extent(mdem),buffer=1000),
nrow=ncol(mdem),ncol=nrow(mdem))
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_bay_P080_2018.nc"
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_13_mhw_2012.nc"
f <- here::here("data-raw", basename(u))
if (!file.exists(f)) curl::curl_download(u, f)
monterey_dem0 <- raster::raster(f)
library(raster)
## original rayshader used seq(1, 8001, by = 20) and seq(1001, 9001, by = 20)
target <- projectExtent(crop(raster(monterey_dem0), extent(monterey_dem0, 1, 8001, 1001, 9001)),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
# library(anglr)
# plot3d(copy_down(QUAD(monterey_dem), monterey_dem))
library(rayshader)
mdem <- aggregate(monterey_dem, fact = 4)
## can't see what the orientation is yet, rayshader works in something different to either image or raster
a <- matrix(raster::extract(mdem,raster::extent(mdem),buffer=1000),
nrow=ncol(mdem),ncol=nrow(mdem))
b <- as.matrix(mdem)
image(a, useRaster = TRUE)
image(b, useRaster = TRUE)
image(a, useRaster = TRUE)
b <- t(as.matrix(mdem))
image(b, useRaster = TRUE)
## can't see what the orientation is yet, rayshader works transpose to raster
## (image is transposed and flipped rel to raster)
#a <- matrix(raster::extract(mdem,raster::extent(mdem),buffer=1000),
#       nrow=ncol(mdem),ncol=nrow(mdem))
#b <- t(as.matrix(mdem))
mdem <- t(as.matrix(mdem))
library(rayshader)
mdem <- aggregate(monterey_dem, fact = 4)
## can't see what the orientation is yet, rayshader works transpose to raster
## (image is transposed and flipped rel to raster)
#a <- matrix(raster::extract(mdem,raster::extent(mdem),buffer=1000),
#       nrow=ncol(mdem),ncol=nrow(mdem))
#b <- t(as.matrix(mdem))
mdem <- t(as.matrix(mdem))
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1")
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
shade3d(qm, texture = "texture.png", col = "white")
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, 2)
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(montereybay,zscale=200)) %>%
add_shadow(ambient_shade(montereybay,zscale=200))
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(mdemy,zscale=200)) %>%
add_shadow(ambient_shade(mdem,zscale=200))
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(mdem,zscale=200)) %>%
add_shadow(ambient_shade(mdem,zscale=200))
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
mdem  %>%
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(mdem,zscale=200)) %>%
add_shadow(ambient_shade(mdem,zscale=200)) %>%
plot_3d()
plot_3d(sh)
plot_3d(sh, mdem)
rgl.close()
plot_3d(sh, mdem)
aspect3d(1, 1, 1)
aspect3d(1, 1, .3)
plot_3d(sh, mdem)
## remember that rgl.surface is x, z, y
aspect3d(1, 0.3, 1)
rgl.open()
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
?rgl.open
par3d()
rgl.open()
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
?light3d
rgl.open()
shade3d(qm, texture = "texture.png", col = "white")
light3d(theta = 0)
aspect3d(1, 1, .2)
plot_3d
par3d(lit = TRUE)
?rgl.surface
rgl.material(lit = TRUE)
rgl.material(lit = TRUE, back = "filled")
light3d(theta = 45)
light3d(theta = -45)
light3d(phi = -45)
shade3d(qm, texture = "texture.png", col = "white")
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
light3d(theta = 0, phi = 15)
light3d(theta = 60, phi = 15)
light3d(theta = 90, phi = 15)
light3d(theta = -90, phi = 15)
light3d(theta = 0, phi = 15)
light3d(theta = 0, phi = 45)
light3d(theta = 0, phi = -45)
light3d(theta = 0, phi = -90)
light3d(theta = 0, phi = 0)
light3d(theta = 0, phi = 30)
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
light3d(theta = 0, phi = 30)
shade3d(qm, texture = "texture.png", col = "white")
aspect3d(1, 1, .2)
#light3d(theta = 0, phi = 30)
rgl.open()
plot_3d(sh, mdem)
## remember that rgl.surface is x, z, y
aspect3d(1, 0.3, 1)
#rgl.open()
shade3d(qm, texture = "texture.png", col = "white", specular = "black")
aspect3d(1, 1, .2)
#light3d(theta = 0, phi = 30)
rgl.open()
plot_3d(sh, mdem)
## remember that rgl.surface is x, z, y
aspect3d(1, 0.3, 1)
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_bay_P080_2018.nc"
u <- "https://www.ngdc.noaa.gov/thredds/fileServer/regional/monterey_13_mhw_2012.nc"
f <- here::here("data-raw", basename(u))
if (!file.exists(f)) curl::curl_download(u, f)
monterey_dem0 <- raster::raster(f)
library(raster)
## original rayshader used seq(1, 8001, by = 20) and seq(1001, 9001, by = 20)
target <- projectExtent(crop(raster(monterey_dem0), extent(monterey_dem0, 1, 8001, 1001, 9001)),
"+proj=lcc +lon_0=-122 +lat_0=36.45 +lat_1=36.7 +lat_2=37.2 +datum=WGS84")
extent(target) <- spex::buffer_extent(target, 80)
res(target) <- 80
monterey_dem <- projectRaster(monterey_dem0, target)
# library(anglr)
# plot3d(copy_down(QUAD(monterey_dem), monterey_dem))
library(rayshader)
mdem <- aggregate(monterey_dem, fact = 4)
## can't see what the orientation is yet, rayshader works transpose to raster
## (image is transposed and flipped rel to raster)
#a <- matrix(raster::extract(mdem,raster::extent(mdem),buffer=1000),
#       nrow=ncol(mdem),ncol=nrow(mdem))
#b <- t(as.matrix(mdem))
mdem <- t(as.matrix(mdem))
#mdem <- as.matrix(monterey_dem)
sh <- mdem  %>%
sphere_shade(texture = "imhof1") %>%
add_shadow(ray_shade(mdem,zscale=200)) %>%
add_shadow(ambient_shade(mdem,zscale=200))
## run the rayshader plot AFTER the generic one as it modifies the context
rgdal::writeGDAL(as(brick(sh * 256), "SpatialGridDataFrame"), "texture.png", driver = "PNG")
qm <- quadmesh::quadmesh(monterey_dem)
library(rgl)
## the texture coords are the centres, just scaled  see link for more general re-mapping
## https://gist.github.com/mdsumner/dc80283de50bb23ff7681b14768b9367#file-rgl_texture-r
qm$texcoords <- t(xyFromCell(setExtent(monterey_dem, extent(0, 1, 0, 1)),
cellFromXY(monterey_dem, t(qm$vb[1:2, ]))))
library(rgl)
#rgl.open()
shade3d(qm, texture = "texture.png", col = "white", specular = "black")
aspect3d(1, 1, .2)
#light3d(theta = 0, phi = 30)
## run the rayshader plotting
rgl.open()
plot_3d(sh, mdem)
## remember that rgl.surface is x, z, y
aspect3d(1, 0.3, 1)
raster::intersect(sf::st_transform(cst, raster::projection(monterey_dem)),
extent(monterey_dem))
## because we are in real coordinates we can add other objects
cst <- rnaturalearth::ne_coastline(returnclass = "sf")
?rnaturalearth::ne_coastline
## because we are in real coordinates we can add other objects
cst <- rnaturalearth::ne_coastline(returnclass = "sf")
raster::intersect(sf::st_transform(cst, raster::projection(monterey_dem)),
extent(monterey_dem))
## run the rayshader plotting
rgl.open()
raster::intersect(as(sf::st_transform(cst, raster::projection(monterey_dem)), "Spatial"),
extent(monterey_dem))
as(sf::st_transform(cst, raster::projection(monterey_dem)), "Spatial")
raster::intersect(as(sf::st_transform(cst, raster::projection(monterey_dem)), "Spatial"),
monterey_dem)
?raster::intersect
raster::intersect(as(sf::st_transform(cst, raster::projection(monterey_dem)), "Spatial"),
spex::spex(monterey_dem))
cst_local <- raster::intersect(as(sf::st_transform(cst, raster::projection(monterey_dem)), "Spatial"),
spex::spex(monterey_dem))
library(anglr)
plot3d(silicate::SC(cst_local))
#rgl.open()
shade3d(qm, texture = "texture.png", col = "white", specular = "black")
aspect3d(1, 1, .2)
## because we are in real coordinates we can add other objects
cst <- rnaturalearth::ne_coastline(returnclass = "sf")
cst_local <- raster::intersect(as(sf::st_transform(cst, raster::projection(monterey_dem)), "Spatial"),
spex::spex(monterey_dem))
library(anglr)
plot3d(silicate::SC(cst_local), add = TRUE)
